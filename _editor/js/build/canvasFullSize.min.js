(function(w,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(w=typeof globalThis<"u"?globalThis:w||self,w.StudioSdkPlugins_canvasFullSize=g())})(this,function(){"use strict";function w(e,a,s){let n,i,c,r,f;const l=a;function u(){const m=Date.now()-r;m<l&&m>=0?n=setTimeout(u,l-m):(n=null,f=e.apply(c,i),c=i=null)}const o=function(){return c=this,i=arguments,r=Date.now(),n||(n=setTimeout(u,l)),f};return o.clear=function(){n&&(clearTimeout(n),n=null)},o.flush=function(){n&&(f=e.apply(c,i),c=i=null,clearTimeout(n),n=null)},o}const g="app.grapesjs.com",N="app-stage.grapesjs.com",P=[g,N,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],z="license:check:start",F="license:check:end",K=()=>typeof window<"u",V=({isDev:e,isStage:a})=>`${e?"":`https://${a?N:g}`}/api`,q=()=>{const e=K()&&window.location.hostname;return!!e&&(P.includes(e)||P.some(a=>e.endsWith(a)))};async function B({path:e,baseApiUrl:a,method:s="GET",headers:n={},params:i,body:c}){const f=`${a||V({isDev:!1,isStage:!1})}${e}`,l={method:s,headers:{"Content-Type":"application/json",...n}};c&&(l.body=JSON.stringify(c));const u=i?new URLSearchParams(i).toString():"",o=u?`?${u}`:"",m=await fetch(`${f}${o}`,l);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return m.json()}var v=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(v||{});const I={[v.free]:0,[v.startup]:10,[v.business]:20,[v.enterprise]:30};function G(e){const a=e;return a.init=s=>n=>e(n,s),a}const X=e=>G(e);async function Y({editor:e,plan:a,pluginName:s,licenseKey:n,cleanup:i}){let c="",r=!1;const f=q(),l=o=>{console.warn("Cleanup plugin:",s,"Reason:",o),i()},u=(o={})=>{var S;const{error:m,sdkLicense:A}=o,y=(S=o.plan)==null?void 0:S.category;if(!(A||o.license)||m)l(m||"Invalid license");else if(y){const T=I[a],H=I[y];T>H&&l({pluginRequiredPlan:a,licensePlan:y})}};e.on(z,o=>{c=o==null?void 0:o.baseApiUrl,r=!0}),e.on(F,o=>{u(o)}),setTimeout(async()=>{if(!r){if(f)return;if(n){const o=await Z({licenseKey:n,pluginName:s,baseApiUrl:c});o&&u(o)}else l("The `licenseKey` option not provided")}},2e3)}async function Z(e){const{licenseKey:a,pluginName:s,baseApiUrl:n}=e;try{return(await B({baseApiUrl:n,path:`/sdk/${a||"na"}`,method:"POST",params:{d:window.location.hostname,pn:s}})).result||{}}catch(i){return console.error("Error during SDK license check:",i),!1}}const U="canvasFullSize",J=v.startup,Q=(e,a)=>{var c;const{rule:s,ruleView:n}=a,{style:i}=s.attributes;if(i&&i[e]){const r=i[e],f=(c=r==null?void 0:r.endsWith)==null?void 0:c.call(r,"vh"),l=n.frameView.model;if(f&&l.hasAutoHeight()){const u=parseFloat(r),o=s.toCSS({style:{...i,[e]:`${window.outerHeight*(u/100)}px`}});a.css=o}}},ee=e=>{["height","min-height","max-height"].forEach(a=>Q(a,e))};return X(function(e,a={}){const{Canvas:s,Commands:n,Devices:i,Css:c}=e,r={deviceMaxWidth:1200,deviceMinHeigth:500,canvasOffsetY:30,canvasOffsetX:50,canvasTransition:.3,frameBorderRadius:5,frameTransition:.3,...a},{canvasOffsetY:f,canvasOffsetX:l,canvasTransition:u,deviceMaxWidth:o,deviceMinHeigth:m,frameBorderRadius:A,frameTransition:y}=r,b=`${m}px`,S=s.events,T="core:preview",H=`${n.events.stopCommand}${T}`,x=s.getConfig(),W=`${U}:disable`,te=i.getAll().map(t=>({...t.attributes})),ne=u*1e3,k={x:l,y:f};let C={},j,E;x.scrollableCanvas=!0,i.getAll().map(t=>{!t.get("width")&&t.set("width",`${o}px`),!t.get("height")&&t.set("height","auto"),!t.get("minHeight")&&t.set("minHeight",b)});const M=t=>{const d="data-gs-plg-full-size",p=document.querySelector(`style[${d}]`);if(t&&p)return p.remove();const h=p||document.createElement("style"),D=s.getZoomMultiplier();h.setAttribute(d,"true"),h.innerHTML=`
      .gjs-frame-wrapper { transition: width ${y}s !important; }
      .gjs-frame-wrapper__bottom { height: ${f*D}px }
      .gjs-frame { border-radius: ${A}px }
    `,!p&&document.body.appendChild(h)};e.on(S.frameLoadHead,t=>{if(!x.scrollableCanvas)return;const{window:d}=t,p=d.document,h=p.head,D="data-gs-plg-wrapper-style",L=h.querySelector(`style[${D}]`)||p.createElement("style");L.setAttribute(D,"true"),L.innerHTML=`
      [data-gjs-type="wrapper"] { min-height: ${b}; }
      [data-gjs-type="mjml"] { min-height: ${b} !important; }
      [data-gjs-type="mj-body"] { min-height: ${b} !important; }
    `,!h.contains(L)&&h.appendChild(L)});const _=()=>j.style.display="none",se=()=>j.style.display="",$=w(()=>{s.fitViewport({zoom:t=>t>100?100:t,ignoreHeight:!0,gap:k}),M(),setTimeout(()=>{var d,p;const{em:t}=e;t.destroyed||((p=(d=e.getSelected())==null?void 0:d.getEl())==null||p.scrollIntoView({block:"nearest"}),e.refresh({tools:!0}),se(),n.isActive(T)?t.stopDefault():t.runDefault())},ne)},100),oe=(t={})=>{t.options&&t.options.from!=="fitViewport"&&s.fitViewport({zoom:s.getZoom(),ignoreHeight:!0,gap:k})},ie=()=>{_(),$()},ae=()=>{C.overflowX="hidden",C.overflowY="auto"},O=()=>{E==null||E.disconnect(),$.clear()},R=[[i.events.select,ie],[S.zoom,oe],[H,ae],[e.events.destroy,O],[c.events.mountBefore,ee]];n.add(W,()=>{i.devices.reset(te),x.scrollableCanvas=!1,s.getModel().updateDevice(),s.setZoom(100),s.setCoords(0,0),C.overflowY="hidden",M(!0),R.forEach(([t,d])=>e.off(t,d)),O(),n.run("studio:canvasReload")}),R.forEach(([t,d])=>e.on(t,d)),e.onReady(()=>{const t=s.getElement(),d=s.getFramesEl();j=s.getSpotsEl(),C=t.style,C.overflowX="hidden",d.style.transition=`transform ${u}s`,M(),E=new ResizeObserver(()=>{_(),$()}),E.observe(t.parentElement),$()}),Y({editor:e,licenseKey:r.licenseKey,plan:J,pluginName:U,cleanup:()=>{e.runCommand(W)}})})});